FROM node:alpine AS build

ARG FOUNDRY_RELEASE_URL

ENV ARCHIVE="foundryvtt.zip"

WORKDIR $HOME/foundryvtt

RUN apk add --no-cache wget unzip && \
	wget -O ${ARCHIVE} "${FOUNDRY_RELEASE_URL}" && \
	unzip -q ${ARCHIVE} && \
	rm ${ARCHIVE}
	
FROM node:alpine

ENV NODE_ENV="production"

COPY --from=build $HOME/foundryvtt $HOME/foundryvtt

WORKDIR $HOME/foundryvtt

VOLUME ["/data"]

EXPOSE 80/TCP
EXPOSE 443/TCP

CMD ["resources/app/main.js", \
			"--port=80", \
			"--headless", \
			"--noupdate", \
			"--dataPath=/data"]